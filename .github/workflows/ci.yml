
name: Run CI Pipeline

on:
  pull_request:
    branches:
      - master

jobs:
  ci:
    runs-on: ubuntu-latest
    steps:
      - name: Build
        uses: fifsky/ssh-action@master
        with:
          command: |
            cd 
            cd CI
            rm -rf Trabalho-Individual-2020-2
            git clone https://github.com/helenagoulart/Trabalho-Individual-2020-2/
            cd Trabalho-Individual-2020-2
            git checkout ${{ github.event.pull_request.head.ref }}
            docker-compose up --build -d
            command docker exec -it client /bin/sh -c "yarn install && yarn run test:unit"
            command docker exec -it api /bin/sh -c "bundle install && export RAILS_ENV=test && rake db:create && rake db:migrate && rake test"
          host: ${{ secrets.DO_HOST }}
          pass: ${{ secrets.DO_PASSWORD }}